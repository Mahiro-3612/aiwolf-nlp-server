# プロトコルの実装について

このドキュメントでは、プロトコルの実装について説明します。  
ここで指すプロトコルとは、技術レイヤーのプロトコルではなく、人狼知能のエージェントとサーバ間のやり取りの際の文字列としてのプロトコルです。  
また、従来の人狼知能対戦接続システムでは、エージェント側がサーバとして待ち受けするため、ゲームマスタ側をサーバと呼ばずに対戦接続システムと表記していましたが、WebSocketを使用したこのシステムでは、ゲームマスタ側がサーバとして待ち受けをするため、ゲームマスタ側をサーバ、エージェント側をクライアントと表記します。

## プロトコルの概要

サーバがエージェントに送るメッセージは、すべてJSON形式の文字列です。  
それに対して、エージェントがサーバに送るメッセージは、すべて生の文字列です。  
また、このドキュメントではサーバがエージェントに送るメッセージをリクエスト、エージェントがサーバに送るメッセージをレスポンスと表記します。

### リクエストの概要

リクエストの種類は、`model/request.go` に定義されています。  
- 名前リクエスト `NAME`
- トークリクエスト `TALK`
- 囁きリクエスト `WHISPER`
- 投票リクエスト `VOTE`
- 占いリクエスト `DIVINE`
- 護衛リクエスト `GUARD`
- 襲撃リクエスト `ATTACK`
- ゲーム開始リクエスト `INITIALIZE`
- 昼開始リクエスト `DAILY_INITIALIZE`
- 昼終了リクエスト `DAILY_FINISH`
- ゲーム終了リクエスト `FINISH`

リクエストの種類によって、リクエストに含まれる情報が異なり、レスポンスを返す必要があるかどうかも異なります。

### レスポンスの概要

レスポンスは、トークや囁きリクエストに対してエージェントが発する自然言語を返す場合（例: `こんにちは`）と、投票や占いリクエストなどに対して対象のエージェントのインデックス付き文字列（例: `Agent[01]`）を返す２種類があります。

## プロトコルの詳細

各リクエストについて、実際の例を示しながら説明します。

### 名前リクエスト (NAME)

名前リクエストは、エージェントがサーバに接続した際に送信されるリクエストです。  
エージェントは、このリクエストを受信した際に、自身の名前を返す必要があります。  
複数エージェントを接続する場合、後ろにユニークな数字をつける必要があります。  
例えば、`dpetektq` という名前を返す場合、`dpetektq1`、`dpetektq2` などとします。  
後ろの数字を除いた名前は、エージェントのチーム名として扱われます。
